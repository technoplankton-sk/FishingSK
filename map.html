<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    
    <link rel="icon" type="image/png" href="logo.png">
    <title>–ö–∞—Ä—Ç–∞ –≤–æ–¥–æ–π–º –ú–∏–∫–æ–ª–∞—ó–≤—â–∏–Ω–∏ - –¢–µ—Ö–Ω–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω SK</title>
    
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ —Ç–∞ —Å–∫—Ä–∏–ø—Ç—ñ–≤ –¥–ª—è –∫–∞—Ä—Ç–∏ Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("EIuYN1VMmFHd5X94Y"); 
        })();
    </script>

    <style>
        /* –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü –ó –í–ê–®–û–ì–û –°–ê–ô–¢–£ */
        body { 
            margin: 0; 
            padding: 0; 
            font-family: Arial, sans-serif; 
            background: url('Images/5.jpg') no-repeat center center fixed; 
            background-size: cover; 
            color: white; 
            min-height: 100vh; 
        }

        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 50px; 
            background: #000000; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.5); 
            position: sticky; 
            top: 0; 
            z-index: 1001; 
        }

        .logo { font-size: 20px; font-weight: bold; }

        nav { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; justify-content: center; }
        nav a { 
            color: white; 
            text-decoration: none; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: bold; 
            transition: 0.3s; 
            display: flex; 
            align-items: center; 
        }
        nav a:hover { color: #e67e22; }
        .nav-icon { width: 18px; height: 18px; margin-right: 6px; vertical-align: middle; }

        .cart-btn-header {
            background: #e67e22;
            padding: 8px 15px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: 0.3s;
            color: white;
        }
        #cart-count {
            background: #c0392b;
            color: white;
            border-radius: 50%;
            padding: 2px 7px;
            font-size: 12px;
            margin-left: 8px;
        }

        .main-layout { 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            padding: 30px 20px; 
            max-width: 1200px; 
            margin: 0 auto; 
        }

        .main-title { 
            background: white; 
            color: #1a1a1a; 
            display: inline-block; 
            padding: 10px 40px; 
            border-radius: 12px; 
            font-weight: bold; 
            font-size: 24px; 
            margin-bottom: 25px; 
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .seo-text-visible { 
            background: rgba(0, 0, 0, 0.85); 
            backdrop-filter: blur(5px); 
            color: #ffffff; 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 25px; 
            text-align: center; 
            line-height: 1.6; 
            border: 1px solid rgba(230, 126, 34, 0.4); 
            width: 100%;
            box-sizing: border-box;
        }
        .seo-text-visible h1 { font-size: 22px; margin-top: 0; color: #e67e22; }

        /* –°–¢–ò–õ–Ü –ö–ê–†–¢–ò */
        .map-container-wrapper {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 20px;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #fishing-map {
            width: 100%;
            height: 60vh;
            min-height: 400px;
            border-radius: 15px;
            z-index: 1; 
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–ø–ª–∏–≤–∞—é—á–∏—Ö –≤—ñ–∫–æ–Ω –Ω–∞ –∫–∞—Ä—Ç—ñ */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            background: #fff;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            padding: 0;
            overflow: hidden;
        }
        .leaflet-popup-content {
            margin: 0;
            padding: 15px;
            text-align: center;
            font-family: Arial, sans-serif;
            width: 240px !important; 
        }
        .leaflet-popup-content h3 {
            margin: 0 0 10px 0;
            color: #e67e22;
            font-size: 16px;
        }
        .spot-image {
            display: block; /* –í–ò–ü–†–ê–í–õ–ï–ù–û: –¥–ª—è —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è */
            margin: 0 auto 10px auto; /* –í–ò–ü–†–ê–í–õ–ï–ù–û: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ –∑ –±–æ–∫—ñ–≤ */
            width: 100%;
            max-width: 210px; /* –î–æ–¥–∞–Ω–æ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –≤–∏–≥–ª—è–¥—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤—ñ–∫–Ω–∞ */
            height: 140px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #f4f4f4; 
        }
        .spot-rating {
            font-size: 16px;
            color: #f39c12;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }
        .spot-desc {
            font-size: 13px;
            line-height: 1.4;
            color: #555;
            margin: 0;
        }

        /* –°–¢–ò–õ–Ü –ú–û–î–ê–õ–¨–ù–ò–• –í–Ü–ö–û–ù –¢–ê –ö–û–®–ò–ö–ê */
        .modal-bg {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            justify-content: center; align-items: center; padding: 10px; box-sizing: border-box;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 20px;
            width: 100%; max-width: 500px; text-align: center; color: #333;
            position: relative; max-height: 90vh; overflow-y: auto;
        }
        .contact-row { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 10px; font-size: 18px; padding-left: 20px; flex-wrap: wrap; }
        .contact-label { width: 90px; text-align: left; font-weight: bold; }
        .messenger-icon { width: 26px; height: 26px; vertical-align: middle; margin-left: 8px; cursor: pointer; }

        .shipping-info-banner { background: #fff3cd; color: #856404; padding: 12px; border-radius: 10px; font-size: 13px; line-height: 1.4; border: 1px solid #ffeeba; margin-bottom: 15px; text-align: left; }
        .shipping-icon-mini { height: 18px; vertical-align: middle; margin: 0 3px; }
        .cart-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; font-size: 13px; gap: 10px; flex-wrap: wrap; }
        .qty-controls { display: flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 4px 8px; border-radius: 6px; }
        .qty-btn { background: #000000; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .remove-item { color: #c0392b; cursor: pointer; font-size: 18px; margin-left: 10px; }
        .clear-cart-btn { background: none; border: 1px solid #c0392b; color: #c0392b; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; margin-top: 10px; font-weight: bold; }
        .cart-input, .cart-select { width: 100%; padding: 10px; margin: 5px 0 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .star-red { color: red; font-weight: bold; }
        .btn-submit-order { background: #000000; color: white; font-size: 16px; margin-top: 10px; padding: 15px; border: 1px solid #fff; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-submit-order:disabled { background: #7f8c8d; cursor: not-allowed; }
        
        .toast-msg { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1a1a1a; color: white; padding: 12px 25px; border-radius: 12px; font-size: 14px; font-weight: bold; z-index: 9999; box-shadow: 0 5px 20px rgba(0,0,0,0.6); display: flex; align-items: center; gap: 10px; border: 1px solid #333; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translate(-50%, 50px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

        @media (max-width: 768px) {
            header { flex-direction: column; padding: 10px; }
            nav { flex-wrap: wrap; justify-content: center; gap: 10px; }
            .logo { font-size: 18px; margin-bottom: 5px; text-align: center; }
            .main-title { font-size: 20px; padding: 10px 20px; }
            #fishing-map { height: 50vh; }
        }
    </style>
</head>
<body>

<header>
    <div class="logo" style="display: flex; flex-direction: column;">
        <span>–¢–µ—Ö–Ω–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π" ( SK)</span>
        <span style="font-size: 12px; font-weight: normal; margin-top: 3px;">–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Å–∞–π—Ç –û–ª–µ–≥–∞ –ö–∞—Ä–ø–æ–≤–∞</span>
    </div>
    <nav>
        <a href="index.html"><img src="home-button_5974636.png" class="nav-icon" onerror="this.style.display='none'">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="products.html"><img src="vsitovari(catalog).png" class="nav-icon" onerror="this.style.display='none'">–£—Å—ñ —Ç–æ–≤–∞—Ä–∏</a>
        <a href="galery.html"><img src="galerybutton.png" class="nav-icon" onerror="this.style.display='none'">–ì–∞–ª–µ—Ä–µ—è</a>
        <a onclick="openModal('contactModal')"><img src="contacts.png" class="nav-icon" onerror="this.style.display='none'">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
        <a href="proVirobnika.html"><img src="Images/proVirobnika/unnamed.jpg" class="nav-icon" onerror="this.style.display='none'">–ü—Ä–æ –≤–∏—Ä–æ–±–Ω–∏–∫–∞</a>
        <a href="map.html" style="color: #e67e22;">üó∫Ô∏è –ö–∞—Ä—Ç–∞ –≤–æ–¥–æ–π–º</a>
        <a href="game.html" style="color: #f1c40f;"><img src="Images/poplGame.png" class="nav-icon" onerror="this.style.display='none'">–ì—Ä–∞-–∑–Ω–∏–∂–∫–∞</a>
        <div class="cart-btn-header" onclick="openCart()">üõí –ö–æ—à–∏–∫ <span id="cart-count">0</span></div>
    </nav>
</header>

<div class="main-layout">
    <div class="main-title">üó∫Ô∏è –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –≤–æ–¥–æ–π–º</div>
    
    <div class="seo-text-visible">
        <h1>–ù–∞–π–∫—Ä–∞—â—ñ –º—ñ—Å—Ü—è –¥–ª—è –ª–æ–≤—É —Ç–æ–≤—Å—Ç–æ–ª–æ–±–∞</h1>
        <p>–ù–∞ —Ü—ñ–π –∫–∞—Ä—Ç—ñ –º–∏ –∑—ñ–±—Ä–∞–ª–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ñ –≤–æ–¥–æ–π–º–∏ –ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ —Ç–∞ –æ–∫–æ–ª–∏—Ü—å, –¥–µ –Ω–∞—à —Ç–µ—Ö–Ω–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π" (SK) –ø–æ–∫–∞–∑—É—î –Ω–∞–π–≤–∏—â—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏. –ù–∞—Ç–∏—Å–∫–∞–π—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω—ñ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó, —Ä–µ–π—Ç–∏–Ω–≥ –º—ñ—Å—Ü—è —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –≤–∏–±–æ—Ä—É –ø—Ä–∏–∫–æ—Ä–º–∫–∏!</p>
    </div>

    <div class="map-container-wrapper">
        <div id="fishing-map"></div>
    </div>
</div>

<!-- –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê –¢–ê –ö–û–®–ò–ö -->
<div id="cartModal" class="modal-bg" onclick="handleBgClick(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span style="position:absolute; right:15px; top:10px; cursor:pointer; font-size:24px;" onclick="closeModal('cartModal')">&times;</span>
        <div class="shipping-info-banner">
            üöö <b>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º 24 –≥–æ–¥–∏–Ω:</b><br>
            –ù–æ–≤–∞ –ü–æ—à—Ç–∞, –£–∫—Ä–ü–æ—à—Ç–∞, MeestExpress.
        </div>

        <h2>üõí –í–∞—à –∫–æ—à–∏–∫</h2>
        <div style="color: #c0392b; font-weight: bold; font-size: 15px; margin-bottom: 10px;">–î–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á—É—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ.</div>
        <div id="cart-items-list"></div>
        <div id="cart-controls"><button class="clear-cart-btn" onclick="clearCart()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –∫–æ—à–∏–∫</button></div>
        <div style="font-size:18px; font-weight:bold; margin: 15px 0;">–†–∞–∑–æ–º: <span id="cart-total-sum">0</span> –≥—Ä–Ω</div>
        <div id="discount-msg" style="color: #27ae60; font-weight: bold; margin-bottom: 10px; display: none;">üéâ –ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –∑–Ω–∏–∂–∫—É 5% –∑–∞ –ø–µ—Ä–µ–º–æ–≥—É –≤ –≥—Ä—ñ!</div>
        
        <div id="order-form" style="text-align: left; background: #f4f4f4; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
            <label><span class="star-red">*</span> –í–∞—à–µ —ñ–º'—è:</label>
            <input type="text" id="client-name" class="cart-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è">
            <label><span class="star-red">*</span> –¢–µ–ª–µ—Ñ–æ–Ω:</label>
            <input type="tel" id="client-phone" class="cart-input" value="+380" maxlength="13" oninput="if(!this.value.startsWith('+380')) this.value = '+380'; this.value = '+380' + this.value.substring(4).replace(/[^\d]/g, '');">
            <label><span class="star-red">*</span> –°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
            <select id="shipping-method" class="cart-select" onchange="handleShippingChange()">
                <option value="">–û–±–µ—Ä—ñ—Ç—å –ø–æ—à—Ç—É...</option>
                <option value="Nova Poshta">–ù–æ–≤–∞ –ü–æ—à—Ç–∞</option>
                <option value="Ukrposhta">–£–∫—Ä–ü–æ—à—Ç–∞</option>
                <option value="Meest">Meest Express</option>
            </select>
            <div id="delivery-details" style="display:none;">
                <label><span class="star-red">*</span> –ú—ñ—Å—Ç–æ:</label>
                <input type="text" id="client-city" class="cart-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–æ">
                <label><span class="star-red">*</span> ‚Ññ –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ê–¥—Ä–µ—Å–∞:</label>
                <input type="text" id="client-address" class="cart-input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è ‚Ññ1">
            </div>
            <label><span class="star-red">*</span> –°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:</label>
            <select id="payment-method" class="cart-select">
                <option value="–ü—ñ—Å–ª—è–ø–ª–∞—Ç–∞">–ü—ñ—Å–ª—è–ø–ª–∞—Ç–∞ (–Ω–∞ –ø–æ—à—Ç—ñ)</option>
                <option value="LiqPay">–û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ (Visa/Mastercard/ApplePay)</option>
            </select>
        </div>
        <div id="rate-limit-msg" style="color:red; font-size:12px; margin-bottom:10px; display:none;"></div>
        <button class="btn-submit-order" id="submit-order-btn" onclick="sendOrderEmail()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
    </div>
</div>

<div id="contactModal" class="modal-bg" onclick="handleBgClick(event)">
    <div class="modal-content" style="max-width: 420px;">
        <span style="position:absolute; right:15px; top:10px; cursor:pointer; font-size:24px;" onclick="closeModal('contactModal')">&times;</span>
        <h2>üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü—è</h2>
        <div style="text-align: left;">
            <div class="contact-row"><span class="contact-label">–ö–∏—ó–≤—Å—Ç–∞—Ä:</span><span class="contact-number">+38 (097) 334-86-67 üìû</span></div>
            <div class="contact-row">
                <span class="contact-label">Lifecell:</span><span class="contact-number">+38 (093) 218-12-63 üìû</span>
            </div>
            <div class="contact-row" style="margin-top: 15px;">
                <span class="contact-label">E-mail:</span><span class="contact-number"><a href="mailto:olegkarpov078@gmail.com">olegkarpov078@gmail.com</a></span>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #e67e22; color: #333; line-height: 1.4;">
                <b style="color: #000;">–ê–¥—Ä–µ—Å–∞ –Ω–∞—à–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É:</b><br>
                –£–∫—Ä–∞—ó–Ω–∞, –º. –ú–∏–∫–æ–ª–∞—ó–≤, —Ä–∏–Ω–æ–∫ "–ö–æ–ª–æ—Å", 134–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–±—ñ–ª—è –º–∞–≥–∞–∑–∏–Ω—É "–ö–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏–π –º–∏—Ä").
            </div>
        </div>
        <button class="btn-submit-order" style="margin-top:20px; width:100%; justify-content:center; background:#e67e22;" onclick="closeModal('contactModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
</div>

<div id="successOrderModal" class="modal-bg" onclick="handleBgClick(event)">
    <div class="modal-content" style="max-width: 400px; padding: 40px 20px;">
        <div style="font-size: 50px; color: #27ae60; margin-bottom: 20px;">‚úÖ</div>
        <h2 style="color: #27ae60; margin-bottom: 15px;">–î—è–∫—É—î–º–æ!</h2>
        <p style="font-size: 16px; line-height: 1.5; color: #333;">–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ.<br>–ú–∏ –∑–≤'—è–∂–µ–º–æ—Å—å –∑ –í–∞–º–∏ —É –Ω–∞–π–±–ª–∏–∂—á–∏–π —á–∞—Å.</p>
        <button class="btn-submit-order" style="margin-top: 25px; width: 150px; display: inline-block; background: #e67e22;" onclick="closeModal('successOrderModal')">–û–ö</button>
    </div>
</div>

<script>
    // === –õ–û–ì–Ü–ö–ê –ö–ê–†–¢–ò (LEAFLET.JS) ===
    document.addEventListener("DOMContentLoaded", function() {
        var map = L.map('fishing-map').setView([47.4, 31.8], 9);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);

        // –ë–ê–ó–ê –î–ê–ù–ò–• –ú–Ü–°–¶–¨ –ó –õ–û–ö–ê–õ–¨–ù–ò–ú–ò –§–û–¢–û (Images/map/)
        // –®–ª—è—Ö–∏ —Ç–∞ –Ω–∞–∑–≤–∏ —Ñ–∞–π–ª—ñ–≤ –ø—Ä–∏–≤–µ–¥–µ–Ω—ñ —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –¥–æ –≤–∞—à–æ—ó –ø–∞–ø–∫–∏ E:\My-Site\Images\map
        var fishingSpots = [
            {
                name: "—Å. –°–µ–º–µ–Ω—ñ–≤–∫–∞ (–ê—Ä–±—É–∑–∏–Ω—Å—å–∫–∏–π —Ä-–Ω)",
                lat: 47.9333,
                lng: 31.1167,
                rating: 5,
                img: "Images/map/semenovka.jpg",
                desc: "–û–¥–Ω–µ –∑ –Ω–∞–π–∫—Ä–∞—â–∏—Ö –º—ñ—Å—Ü—å –¥–ª—è –ª–æ–≤—É —Ç—Ä–æ—Ñ–µ–π–Ω–æ–≥–æ —Ç–æ–≤—Å—Ç–æ–ª–æ–±–∞! –ì–ª–∏–±–∏–Ω–∞ —á—É–¥–æ–≤–∞. –ù–∞–π–∫—Ä–∞—â–µ –ø—Ä–∞—Ü—é—î —Ç–µ—Ö–Ω–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω ¬´–ú–µ–¥¬ª —Ç–∞ ¬´–ü–æ–ª—É–Ω–∏—Ü—è¬ª."
            },
            {
                name: "—Å. –©–µ—Ä–±–∞–Ω—ñ (–í–æ–∑–Ω–µ—Å–µ–Ω—Å—å–∫–∏–π —Ä-–Ω)",
                lat: 47.5320,
                lng: 31.7510,
                rating: 4,
                img: "Images/map/sherbani.jpg",
                desc: "–í—ñ–¥–º—ñ–Ω–Ω–∏–π —Å—Ç–∞–≤–æ–∫ –∑ —Ö–æ—Ä–æ—à–∏–º –ø—ñ–¥'—ó–∑–¥–æ–º. –¢–æ–≤—Å—Ç–æ–ª–æ–± —Ç—É—Ç –≤—ñ–¥–¥–∞—î –ø–µ—Ä–µ–≤–∞–≥—É —Å–æ–ª–æ–¥–∫–∏–º –∞—Ä–æ–º–∞—Ç–∞–º. –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª."
            },
            {
                name: "—Ä. –ü—ñ–≤–¥–µ–Ω–Ω–∏–π –ë—É–≥ (–ù–æ–≤–∞ –û–¥–µ—Å–∞)",
                lat: 47.3050,
                lng: 31.7850,
                rating: 3,
                img: "Images/map/novaOdesa.jpg",
                desc: "–†—ñ—á–∫–æ–≤–∞ –ª–æ–≤–ª—è. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –≤–µ–ª–∏–∫—ñ –±–æ—Ä–∏–ª—å—Ü—è –Ω–∞ 140–≥ (¬´–ú–∞–∫—É—Ö–∞¬ª –∞–±–æ ¬´–ú–µ–¥¬ª), —â–æ–± –≤–æ–Ω–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ —Ä–æ–∑–º–∏–≤–∞–ª–∏—Å—è –Ω–∞ —Ç–µ—á—ñ—ó."
            },
            {
                name: "–°–æ—Ñ—ñ—ó–≤—Å—å–∫–µ –≤–æ–¥–æ—Å—Ö–æ–≤–∏—â–µ",
                lat: 47.6810,
                lng: 32.3350,
                rating: 5,
                img: "Images/map/SofiyivskeVodoshovishe.jpg",
                desc: "–í–µ–ª–∏–∫–∞ –≤–æ–¥–∞ ‚Äî –≤–µ–ª–∏–∫–∞ —Ä–∏–±–∞. –ß—É–¥–æ–≤–µ –º—ñ—Å—Ü–µ –¥–ª—è —Ç—Ä–∏–≤–∞–ª–∏—Ö —Å–µ—Å—ñ–π. –ù–∞–π–∫—Ä–∞—â–µ –ø—Ä–∞—Ü—é—î —Ç–µ—Ö–Ω–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª —Ç–∞ ¬´–ú–µ–¥¬ª."
            },
            {
                name: "–º. –ú–∏–∫–æ–ª–∞—ó–≤ (—Ä. –Ü–Ω–≥—É–ª)",
                lat: 47.0160,
                lng: 32.0300,
                rating: 4,
                img: "Images/map/ingulNikolaev.jpg",
                desc: "–•–æ—Ä–æ—à—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—Ä—è–º–æ –≤ –º—ñ—Å—Ç—ñ. –†–∏–±–∞ –ø–µ—Ä–µ–±—ñ—Ä–ª–∏–≤–∞, –±–µ—Ä—ñ—Ç—å —ñ–∑ —Å–æ–±–æ—é ¬´–ü–æ–ª—É–Ω–∏—Ü—é¬ª —Ç–∞ ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª."
            },
            {
                name: "–û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤—Å—å–∫–µ –≤–æ–¥–æ—Å—Ö–æ–≤–∏—â–µ",
                lat: 47.6975,
                lng: 31.2658,
                rating: 5,
                img: "Images/map/oleksandrivskeVodoshovishe.jpg",
                desc: "–¢—É—Ç –ª–æ–≤–ª—è—Ç—å —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö –≥—ñ–≥–∞–Ω—Ç—ñ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ä–∏–ª—å—Ü—è 110–≥-140–≥ –∑—ñ —Å–º–∞–∫–æ–º ¬´–ü–æ–ª—É–Ω–∏—Ü—è¬ª."
            },
            {
                name: "—Å. –ü–µ–ª–∞–≥–µ—ó–≤–∫–∞ (—Ä. –Ü–Ω–≥—É–ª)",
                lat: 47.7167,
                lng: 32.3167,
                rating: 4,
                img: "Images/map/pelageevka.jpg",
                desc: "–ú–∞–ª—å–æ–≤–Ω–∏—á–µ –º—ñ—Å—Ü–µ –±—ñ–ª—è –º–æ–Ω–∞—Å—Ç–∏—Ä—è. –¢–æ–≤—Å—Ç–æ–ª–æ–± —á–∞—Å—Ç–æ —Å—Ç–æ—ó—Ç—å –Ω–∞ —Ä—É—Å–ª–∞—Ö. –î–æ–±—Ä–µ –ø–æ–∫–∞–∑—É—î —Å–µ–±–µ ¬´–ü–æ–ª—É–Ω–∏—Ü—è¬ª —Ç–∞ ¬´–ú–µ–¥¬ª."
            },
            {
                name: "—Å. –ë–∞–ª–æ–≤–Ω–µ (—Ä. –ü—ñ–≤–¥–µ–Ω–Ω–∏–π –ë—É–≥)",
                lat: 47.0850,
                lng: 31.8840,
                rating: 4,
                img: "Images/map/balovne.jpg",
                desc: "–®–∏—Ä–æ–∫–∞ —Ä—ñ—á–∫–∞, –±—É–≤–∞—î —Å–∏–ª—å–Ω–∞ —Ç–µ—á—ñ—è. –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ –≤–∞–∂–∫–∏–π –ø–ª–∞–Ω–∫—Ç–æ–Ω ¬´–ú–∞–∫—É—Ö–∞¬ª (140–≥) —Ç–∞ –Ω–∞–¥—ñ–π–Ω—ñ —Å–Ω–∞—Å—Ç—ñ."
            },
            {
                name: "—Å. –ö–∞—à–ø–µ—Ä–æ-–ú–∏–∫–æ–ª–∞—ó–≤–∫–∞ (—Å—Ç–∞–≤–∫–∏)",
                lat: 47.3820,
                lng: 32.1850,
                rating: 5,
                img: "Images/map/kashperoMikolaivka.jpg",
                desc: "–ü–æ–ø—É–ª—è—Ä–Ω—ñ –≤–æ–¥–æ–π–º–∏. –†–∏–±–∞ —á—É–¥–æ–≤–æ —Ä–µ–∞–≥—É—î –Ω–∞ —Å–æ–ª–æ–¥–∫—ñ —Ç–∞ –≤–µ—Ä—à–∫–æ–≤—ñ –∞—Ä–æ–º–∞—Ç–∏, –æ—Å–æ–±–ª–∏–≤–æ ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª."
            },
            {
                name: "—Å. –ó–∞–π—á—ñ–≤—Å—å–∫–µ (—Ä. –Ü–Ω–≥—É–ª)",
                lat: 47.0340,
                lng: 32.1020,
                rating: 3,
                img: "Images/map/zaichivske.jpg",
                desc: "–ó—Ä—É—á–Ω–æ –¥–ª—è —à–≤–∏–¥–∫–∏—Ö –≤–∏—ó–∑–¥—ñ–≤ –∑ –ú–∏–∫–æ–ª–∞—î–≤–∞. –¢–æ–≤—Å—Ç–æ–ª–æ–± —Ç—É—Ç –ª—é–±–∏—Ç—å –∫–ª–∞—Å–∏–∫—É ‚Äî ¬´–ú–µ–¥¬ª —Ç–∞ ¬´–ü–æ–ª—É–Ω–∏—Ü—è¬ª."
            },
            {
                name: "—Å. –ì—É—Ä'—ó–≤–∫–∞ (—Ä. –ü—ñ–≤–¥–µ–Ω–Ω–∏–π –ë—É–≥)",
                lat: 47.1670,
                lng: 31.8520,
                rating: 4,
                img: "Images/map/gurivka.jpg",
                desc: "–ì–∞—Ä–Ω—ñ –≥–ª–∏–±–∏–Ω–∏ —Ç–∞ —Ä–µ–ª—å—î—Ñ –¥–Ω–∞. –ß–∞—Å—Ç–æ —Ç—Ä–∞–ø–ª—è—é—Ç—å—Å—è —Ç—Ä–æ—Ñ–µ–π–Ω—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä–∏. –í–∞—Ä—Ç–æ –ø—Ä–æ–±—É–≤–∞—Ç–∏ ¬´–ú–µ–¥¬ª —Ç–∞ ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª."
            },
            {
                name: "–º. –í–æ–∑–Ω–µ—Å–µ–Ω—Å—å–∫ (—Ä. –ü—ñ–≤–¥–µ–Ω–Ω–∏–π –ë—É–≥)",
                lat: 47.5615,
                lng: 31.3135,
                rating: 4,
                img: "Images/map/VoznesenskPivdenniyBug.jpg",
                desc: "–ö–ª–∞—Å–∏—á–Ω–∞ —Ä—ñ—á–∫–æ–≤–∞ –ª–æ–≤–ª—è. –ß–µ—Ä–µ–∑ —Ç–µ—á—ñ—é –ø–ª–∞–Ω–∫—Ç–æ–Ω –≤–∏–º–∏–≤–∞—î—Ç—å—Å—è —à–≤–∏–¥—à–µ, –±–µ—Ä—ñ—Ç—å –Ω–∞–π–±—ñ–ª—å—à—ñ –±–æ—Ä–∏–ª—å—Ü—è ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª –∞–±–æ ¬´–ú–∞–∫—É—Ö–∞¬ª."
            },
            {
                name: "—Å. –ö—ñ—Ä'—è–∫—ñ–≤–∫–∞ (—Å—Ç–∞–≤–∫–∏)",
                lat: 47.2500,
                lng: 31.7800,
                rating: 4,
                img: "Images/map/kyriakivka.jpg",
                desc: "–°–ø–æ–∫—ñ–π–Ω–µ –º—ñ—Å—Ü–µ –∑ —Ö–æ—Ä–æ—à–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º –¥–æ –≤–æ–¥–∏. –ú—ñ—Å—Ü–µ–≤–∏–π —Ç–æ–≤—Å—Ç–æ–ª–æ–± –¥–æ–±—Ä–µ —Ä–µ–∞–≥—É—î –Ω–∞ –∞—Ä–æ–º–∞—Ç ¬´–ü–æ–ª—É–Ω–∏—Ü—è¬ª."
            },
            {
                name: "—Å. –•—Ä–∏—Å—Ç–æ—Ñ–æ—Ä—ñ–≤–∫–∞ (—Ä. –Ü–Ω–≥—É–ª)",
                lat: 47.2340,
                lng: 32.2210,
                rating: 4,
                img: "Images/map/hristoforivka.jpg",
                desc: "–¶—ñ–∫–∞–≤–∏–π —Ä–µ–ª—å—î—Ñ –¥–Ω–∞ –±—ñ–ª—è –æ—á–µ—Ä–µ—Ç—É. –î–ª—è –ø—Ä–∏–≤–∞–±–ª–µ–Ω–Ω—è —Ä–∏–±–∏ —Å—é–¥–∏ —Ä–∞–¥–∏–º–æ –±—Ä–∞—Ç–∏ ¬´–ú–∞–∫—É—Ö—É¬ª."
            },
            {
                name: "—Å. –ü–µ—Ç—Ä–æ–≤–æ-–°–æ–ª–æ–Ω–∏—Ö–∞",
                lat: 47.1024,
                lng: 31.7856,
                rating: 5,
                img: "Images/map/petrovoSoloniha.jpg",
                desc: "–ß—É–¥–æ–≤–∞ –≤–æ–¥–æ–π–º–∞ –ø–æ–±–ª–∏–∑—É –ú–∏–∫–æ–ª–∞—î–≤–∞. –¢–æ–≤—Å—Ç–æ–ª–æ–± —Ç—É—Ç —á–∞—Å—Ç–æ —Ö–æ–¥–∏—Ç—å –∑–≥—Ä–∞—è–º–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ ¬´–ú–µ–¥¬ª —Ç–∞ ¬´–ü—Ä—è–∂–µ–Ω–µ –º–æ–ª–æ–∫–æ¬ª."
            }
        ];

        var customIcon = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        fishingSpots.forEach(function(spot) {
            var starsHtml = '‚≠ê'.repeat(spot.rating) + '‚ú∞'.repeat(5 - spot.rating);
            
            var popupContent = `
                <div class="leaflet-popup-content">
                    <h3>${spot.name}</h3>
                    <img src="${spot.img}" class="spot-image" alt="${spot.name}" onload="this.parentNode.parentNode.parentNode._update && this.parentNode.parentNode.parentNode._update()" onerror="this.onerror=null; this.src='Images/5.jpg';">
                    <div class="spot-rating">${starsHtml}</div>
                    <p class="spot-desc">${spot.desc}</p>
                </div>
            `;

            L.marker([spot.lat, spot.lng], {icon: customIcon})
             .addTo(map)
             .bindPopup(popupContent);
        });
    });

    // === –õ–û–ì–Ü–ö–ê –ö–û–®–ò–ö–ê –¢–ê –ú–û–î–ê–õ–û–ö ===
    let cart = JSON.parse(localStorage.getItem('fishingCart')) || [];

    function showToast(msg, color = "#27ae60") {
        const oldToast = document.querySelector('.toast-msg');
        if (oldToast) oldToast.remove();
        const toast = document.createElement('div');
        toast.className = 'toast-msg';
        toast.style.borderColor = color;
        toast.style.color = color;
        toast.innerHTML = `<span>${msg}</span>`;
        document.body.appendChild(toast);
        setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 3000);
    }

    function checkRateLimit() {
        const now = Date.now();
        const tenMinutes = 10 * 60 * 1000;
        let history = JSON.parse(localStorage.getItem('orderHistory')) || [];
        history = history.filter(timestamp => (now - timestamp) < tenMinutes);
        localStorage.setItem('orderHistory', JSON.stringify(history));
        const submitBtn = document.getElementById('submit-order-btn');
        const msg = document.getElementById('rate-limit-msg');
        if (history.length >= 2) {
            const timeLeft = Math.ceil((tenMinutes - (now - history[0])) / 60000);
            submitBtn.disabled = true;
            msg.innerText = `–í–∏ –ø–µ—Ä–µ–≤–∏—â–∏–ª–∏ –ª—ñ–º—ñ—Ç –∑–∞–º–æ–≤–ª–µ–Ω—å. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ ${timeLeft} —Ö–≤.`;
            msg.style.display = 'block';
            return false;
        } else {
            submitBtn.disabled = false;
            msg.style.display = 'none';
            return true;
        }
    }

    function recordOrder() {
        let history = JSON.parse(localStorage.getItem('orderHistory')) || [];
        history.push(Date.now());
        localStorage.setItem('orderHistory', JSON.stringify(history));
    }

    function handleShippingChange() {
        const method = document.getElementById('shipping-method').value;
        document.getElementById('delivery-details').style.display = method ? 'block' : 'none';
    }

    function updateCartUI() { 
        const cartCountElement = document.getElementById('cart-count');
        if (cartCountElement) {
            cartCountElement.innerText = cart.reduce((acc, i) => acc + i.qty, 0);
        }
        localStorage.setItem('fishingCart', JSON.stringify(cart)); 
    }

    function changeQty(name, delta) {
        const item = cart.find(i => i.name === name);
        if (item) {
            item.qty += delta;
            if (item.qty <= 0) cart = cart.filter(i => i.name !== name);
            updateCartUI(); openCart();
        }
    }

    function removeFromCart(name) { 
        cart = cart.filter(item => item.name !== name); 
        updateCartUI(); 
        openCart();
        showToast("–¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ", "#e67e22");
    }
    
    function clearCart() { 
        if (cart.length === 0) return;
        cart = [];
        updateCartUI(); 
        openCart();
        closeModal('cartModal');
        showToast("–ö–æ—à–∏–∫ –æ—á–∏—â–µ–Ω–æ", "#c0392b");
    }

    function openCart() {
        const list = document.getElementById('cart-items-list');
        const ctrl = document.getElementById('cart-controls');
        let total = 0;
        if (cart.length === 0) { list.innerHTML = '<p style="color:#666; padding:20px;">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>'; ctrl.style.display = 'none'; }
        else {
            list.innerHTML = '';
            ctrl.style.display = 'block';
            cart.forEach(item => { 
                total += item.price * item.qty; 
                list.innerHTML += `<div class="cart-item">
                    <div style="flex:1; text-align:left; color:#333;"><b>${item.name}</b><br><span style="color:#666;">${item.price} –≥—Ä–Ω/—à—Ç</span></div>
                    <div class="qty-controls">
                        <button class="qty-btn" onclick="changeQty('${item.name.replace(/'/g, "\\'")}', -1)">-</button>
                        <span style="color:#000; font-weight:bold; min-width:20px; text-align:center;">${item.qty}</span>
                        <button class="qty-btn" onclick="changeQty('${item.name.replace(/'/g, "\\'")}', 1)">+</button>
                    </div>
                    <b style="color:#000; min-width:60px; text-align:right;">${item.price * item.qty} –≥—Ä–Ω</b>
                    <span class="remove-item" onclick="removeFromCart('${item.name.replace(/'/g, "\\'")}')">‚úñ</span>
                </div>`; 
            });
        }
        
        let hasDiscount = localStorage.getItem('sk_discount_won') === 'true';
        let totalDisplay = document.getElementById('cart-total-sum');
        let discountMsg = document.getElementById('discount-msg');

        if (hasDiscount && total > 0) {
            let discountedTotal = Math.round(total * 0.95);
            totalDisplay.innerHTML = `<span style="text-decoration: line-through; color: #7f8c8d; font-size: 14px;">${total}</span> ${discountedTotal}`;
            if(discountMsg) discountMsg.style.display = 'block';
        } else {
            totalDisplay.innerHTML = total;
            if(discountMsg) discountMsg.style.display = 'none';
        }

        openModal('cartModal');
    }

    function sendOrderEmail() {
        if (!checkRateLimit()) return;
        const name = document.getElementById('client-name').value.trim();
        const phone = document.getElementById('client-phone').value.trim();
        const shipping = document.getElementById('shipping-method').value;
        const city = document.getElementById('client-city').value.trim();
        const address = document.getElementById('client-address').value.trim();
        const payment = document.getElementById('payment-method').value;
        
        let calcTotal = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
        let hasDiscount = localStorage.getItem('sk_discount_won') === 'true';
        let finalTotal = hasDiscount ? Math.round(calcTotal * 0.95) : calcTotal;

        if (cart.length === 0) { showToast("–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π!", "#c0392b"); return; }
        if (!name || phone.length < 13 || !shipping || !city || !address) {
            showToast("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è!", "#e67e22");
            return;
        }
        if (calcTotal < 400) {
            showToast("–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è 400 –≥—Ä–Ω!", "#c0392b");
            return;
        }

        let details = cart.map(i => `${i.name} (${i.qty} —à—Ç.)`).join(', ');
        
        if (hasDiscount) {
            details += `\n\n-------------------------\nüéØ –£–í–ê–ì–ê: –ö–ª—ñ—î–Ω—Ç —á–µ—Å–Ω–æ –≤–∏–≥—Ä–∞–≤ —É –º—ñ–Ω—ñ-–≥—Ä—É!\n–°—É–º–∞ –±–µ–∑ –∑–Ω–∏–∂–∫–∏: ${calcTotal} –≥—Ä–Ω.\n–°—É–º–∞ –¥–æ –æ–ø–ª–∞—Ç–∏ –∑—ñ –∑–Ω–∏–∂–∫–æ—é 5%: ${finalTotal} –≥—Ä–Ω.\n-------------------------`;
        }

        const templateParams = {
            from_name: name,
            user_phone: phone,
            user_address: address,
            shipping_method: shipping,
            payment_method: payment,
            order_details: details,
            total_sum: finalTotal
        };

        emailjs.send("service_2xxpqzw", "template_dkcry58", templateParams)
        .then(() => { 
            recordOrder();
            if (hasDiscount) localStorage.removeItem('sk_discount_won');
            cart = []; updateCartUI(); closeModal('cartModal'); 
            openModal('successOrderModal');
        }).catch(() => showToast("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏!", "#c0392b"));
    }

    window.onload = updateCartUI;

    function openModal(id) { 
        document.getElementById(id).style.display = 'flex';
        if(id === 'cartModal') checkRateLimit();
    }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function handleBgClick(e) { if (e.target.classList.contains('modal-bg')) closeModal(e.target.id); }

</script>
</body>
</html>
